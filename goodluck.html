<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¦æ¨¡æŠ½å¥–ç³»ç»Ÿï¼ˆå‚è€ƒæ‘‡å·ç®—æ³•ï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .user-input-area {
            margin-bottom: 20px;
        }
        .user-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        input[type="number"] {
            width: 120px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-add {
            background-color: #28a745;
            width: 100%;
            margin-bottom: 10px;
        }
        .btn-add:hover {
            background-color: #218838;
        }
        .params-area {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            min-height: 80px;
        }
        .result-area h3 {
            margin-bottom: 10px;
            color: #333;
        }
        .winner-item {
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }
        .error {
            color: #dc3545;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è½¦æ¨¡æŠ½å¥–ç³»ç»Ÿï¼ˆå‚è€ƒæ‘‡å·ç®—æ³•ï¼‰</h1>
        
        <!-- ç”¨æˆ·ä¿¡æ¯å½•å…¥åŒº -->
        <div class="user-input-area">
            <h3>ç”¨æˆ·ä¿¡æ¯å½•å…¥</h3>
            <button class="btn-add" id="addUserBtn">+ æ·»åŠ ç”¨æˆ·</button>
            <div id="usersContainer">
                <!-- åˆå§‹ç”¨æˆ·è¡Œ -->
                <div class="user-row">
                    <input type="text" placeholder="ç”¨æˆ·æ˜µç§°" class="nickname">
                    <input type="number" placeholder="ç‚¹èµæ•°" class="likeCount" min="1" value="1">
                    <button class="btn-danger delete-row">åˆ é™¤</button>
                </div>
            </div>
        </div>

        <!-- æŠ½å¥–å‚æ•°è®¾ç½® -->
        <div class="params-area">
            <input type="number" id="seedInput" placeholder="éšæœºç§å­æ•°ï¼ˆæ•°å­—ï¼‰" min="1" value="">
            <input type="number" id="winnerCountInput" placeholder="ä¸­å¥–äººæ•°" min="1" value="1">
            <button id="drawBtn">å¼€å§‹æŠ½å¥–</button>
            <button id="resetBtn" class="btn-danger">é‡ç½®</button>
        </div>

        <!-- æŠ½å¥–ç»“æœå±•ç¤º -->
        <div class="result-area">
            <h3>æŠ½å¥–ç»“æœ</h3>
            <div id="resultContainer" class="error">è¯·å½•å…¥ç”¨æˆ·ä¿¡æ¯åç‚¹å‡»æŠ½å¥–</div>
        </div>
    </div>

 
    <script>
    !function(f,a,c){var s,l=256,p="random",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=l-1;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&"object"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,"global"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+"",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),"object"==typeof module&&module.exports){module.exports=n;try{s=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd?define(function(){return n}):c["seed"+p]=n}("undefined"!=typeof self?self:this,[],Math);
    </script>
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const usersContainer = document.getElementById('usersContainer');
            const addUserBtn = document.getElementById('addUserBtn');
            const drawBtn = document.getElementById('drawBtn');
            const resetBtn = document.getElementById('resetBtn');
            const resultContainer = document.getElementById('resultContainer');

            // æ·»åŠ ç”¨æˆ·è¡Œ
            addUserBtn.addEventListener('click', function() {
                const newRow = document.createElement('div');
                newRow.className = 'user-row';
                newRow.innerHTML = `
                    <input type="text" placeholder="ç”¨æˆ·æ˜µç§°" class="nickname">
                    <input type="number" placeholder="ç‚¹èµæ•°" class="likeCount" min="1" value="1">
                    <button class="btn-danger delete-row">åˆ é™¤</button>
                `;
                usersContainer.appendChild(newRow);
                
                // ä¸ºæ–°æ·»åŠ çš„åˆ é™¤æŒ‰é’®ç»‘å®šäº‹ä»¶
                newRow.querySelector('.delete-row').addEventListener('click', function() {
                    if (usersContainer.children.length > 1) {
                        newRow.remove();
                    } else {
                        alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªç”¨æˆ·ï¼');
                    }
                });
            });

            // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶ï¼ˆåˆå§‹è¡Œï¼‰
            document.querySelectorAll('.delete-row').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (usersContainer.children.length > 1) {
                        this.parentElement.remove();
                    } else {
                        alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªç”¨æˆ·ï¼');
                    }
                });
            });

            // é‡ç½®æŒ‰é’®
            resetBtn.addEventListener('click', function() {
                // æ¸…ç©ºç”¨æˆ·è¡Œï¼Œä¿ç•™åˆå§‹è¡Œ
                usersContainer.innerHTML = `
                    <div class="user-row">
                        <input type="text" placeholder="ç”¨æˆ·æ˜µç§°" class="nickname">
                        <input type="number" placeholder="ç‚¹èµæ•°" class="likeCount" min="1" value="1">
                        <button class="btn-danger delete-row">åˆ é™¤</button>
                    </div>
                `;
                // é‡ç½®å‚æ•°
                document.getElementById('seedInput').value = '';
                document.getElementById('winnerCountInput').value = '1';
                // é‡ç½®ç»“æœ
                resultContainer.className = 'error';
                resultContainer.textContent = 'è¯·å½•å…¥ç”¨æˆ·ä¿¡æ¯åç‚¹å‡»æŠ½å¥–';
                // é‡æ–°ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.delete-row').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (usersContainer.children.length > 1) {
                            this.parentElement.remove();
                        } else {
                            alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªç”¨æˆ·ï¼');
                        }
                    });
                });
            });

            // æ ¸å¿ƒæŠ½å¥–é€»è¾‘
            drawBtn.addEventListener('click', function() {
                // 1. æ”¶é›†å¹¶æ ¡éªŒç”¨æˆ·æ•°æ®
                const userRows = document.querySelectorAll('.user-row');
                const users = [];
                let hasError = false;
                
                userRows.forEach((row, index) => {
                    const nickname = row.querySelector('.nickname').value.trim();
                    const likeCount = parseInt(row.querySelector('.likeCount').value);
                    
                    if (!nickname) {
                        resultContainer.className = 'error';
                        resultContainer.textContent = `ç¬¬${index+1}ä¸ªç”¨æˆ·çš„æ˜µç§°ä¸èƒ½ä¸ºç©ºï¼`;
                        hasError = true;
                        return;
                    }
                    if (isNaN(likeCount) || likeCount < 1) {
                        resultContainer.className = 'error';
                        resultContainer.textContent = `ç¬¬${index+1}ä¸ªç”¨æˆ·çš„ç‚¹èµæ•°å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—ï¼`;
                        hasError = true;
                        return;
                    }
                    users.push({ nickname, likeCount });
                });
                
                if (hasError) return;

                // 2. æ ¡éªŒæŠ½å¥–å‚æ•°
                const seed = parseInt(document.getElementById('seedInput').value);
                const winnerCount = parseInt(document.getElementById('winnerCountInput').value);
                
                if (isNaN(seed) || seed < 1) {
                    resultContainer.className = 'error';
                    resultContainer.textContent = 'éšæœºç§å­æ•°å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—ï¼';
                    return;
                }
                if (isNaN(winnerCount) || winnerCount < 1 || winnerCount > users.length) {
                    resultContainer.className = 'error';
                    resultContainer.textContent = `ä¸­å¥–äººæ•°å¿…é¡»æ˜¯1-${users.length}ä¹‹é—´çš„æ•°å­—ï¼`;
                    return;
                }

                // 3. æ ¸å¿ƒæŠ½å¥–ç®—æ³•ï¼ˆå‚è€ƒæ‘‡å·ï¼šå›ºå®šç§å­+åŠ æƒéšæœºï¼‰
                // è®¾ç½®éšæœºç§å­ï¼ˆä¿è¯ç›¸åŒç§å­ç»“æœä¸€è‡´ï¼‰
                const rng = new Math.seedrandom(seed);
                
                // æ­¥éª¤1ï¼šè®¡ç®—æ€»ç‚¹èµæ•°ï¼ˆæƒé‡æ€»å’Œï¼‰
                const totalLikes = users.reduce((sum, user) => sum + user.likeCount, 0);
                
                // æ­¥éª¤2ï¼šåŠ æƒæŠ½å¥–ï¼ˆä¸é‡å¤ä¸­å¥–ï¼‰
                const winners = [];
                const remainingUsers = [...users]; // å¾…æŠ½å¥–ç”¨æˆ·å‰¯æœ¬
                
                while (winners.length < winnerCount && remainingUsers.length > 0) {
                    // ç”Ÿæˆ0-æ€»ç‚¹èµæ•°ä¹‹é—´çš„éšæœºæ•°
                    const randomNum = rng() * totalLikes;
                    let currentSum = 0;
                    let selectedIndex = -1;
                    
                    // éå†æ‰¾åˆ°éšæœºæ•°å¯¹åº”çš„ç”¨æˆ·
                    for (let i = 0; i < remainingUsers.length; i++) {
                        currentSum += remainingUsers[i].likeCount;
                        if (currentSum >= randomNum) {
                            selectedIndex = i;
                            break;
                        }
                    }
                    
                    // æ·»åŠ ä¸­å¥–ç”¨æˆ·å¹¶ä»å¾…æŠ½å¥–åˆ—è¡¨ç§»é™¤
                    const winner = remainingUsers.splice(selectedIndex, 1)[0];
                    winners.push(winner);
                }

                // 4. å±•ç¤ºç»“æœ
                resultContainer.className = '';
                let resultHtml = '<div>';
                resultHtml += `<p>ğŸ² éšæœºç§å­ï¼š${seed} | ä¸­å¥–äººæ•°ï¼š${winnerCount}</p>`;
                resultHtml += '<p>ğŸ† ä¸­å¥–ç”¨æˆ·åˆ—è¡¨ï¼š</p>';
                winners.forEach((winner, index) => {
                    resultHtml += `<div class="winner-item">${index+1}. ${winner.nickname}ï¼ˆç‚¹èµæ•°ï¼š${winner.likeCount}ï¼‰</div>`;
                });
                resultHtml += '</div>';
                resultContainer.innerHTML = resultHtml;
            });
        });
    </script>
</body>
</html>